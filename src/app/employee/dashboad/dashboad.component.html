<app-navbar></app-navbar>

<div class="container mt-4" [formGroup]="timesheetForm">
    <h3 class="mb-4 text-primary">Employee Timesheet</h3>

    <!-- Live Time -->
    <div class="row mb-3">
        <div class="col">
            <p class="text-muted">Live Time: {{ currentDateTime | date: 'medium'
                }}</p>
        </div>
    </div>

    <!-- Timeslot -->
    <div class="row mb-4">
        <div class="col-md-3">
            <label for="timeslotId" class="form-label fw-bold">Timeslot</label>
            <select id="timeslotId" class="form-select"
                formControlName="timeslot" (change)="onfunctionchange($event)">
                <option selected disabled>-- Select Timeslot --</option>
                <option *ngFor="let ts of timeslots" [value]="ts.sloT_ID">{{
                    ts.timeslot }}</option>
            </select>
        </div>
    </div>

    <!-- Function Tabs -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="btn-group-vertical w-100" *ngIf="isSlotSelected">
                <button
                    class="btn btn-outline-primary my-1" 
                    [class.active]="selectedFunctionId === fun.fuN_ID"
                    *ngFor="let fun of functions"
                    type="button"
                    (click)="onselectfunction(fun)"
                    [value]="fun.fuN_ID">
                    {{ fun.fuN_NAME }}
                </button>
            </div>
        </div>

        <div class="col-md-9">
            <div class="card shadow-sm" *ngIf="isFunSelected">
                <div class="card-body">
                    <div class="row g-3" >
                        <!-- Project & Client -->
                        <div class="col-md-4" *ngIf="isFunSelected">
                            <label class="form-label fw-bold">ClientCode -
                                ProjectName</label>
                            <select class="form-select"
                                formControlName="projectAndClient"
                                (change)="onprojectselect($event)">
                                <option selected disabled>-- Select Project Name
                                    --</option>
                                <option *ngFor="let prod of projectClients"
                                    [value]="prod.proJ_ID">
                                    {{ prod.client_code }} - {{ prod.proj_name
                                    }}
                                </option>
                            </select>
                            <div class="text-danger small mt-1"
                                *ngIf="timesheetForm.get('projectAndClient')?.invalid && timesheetForm.get('projectAndClient')?.touched">
                                ClientCode - ProjectName is required
                            </div>
                        </div>

                        <!-- Modules -->
                        <div class="col-md-4" *ngIf="isProjectSelected">
                            <label class="form-label fw-bold">Modules</label>
                            <select class="form-select" formControlName="module"
                                (change)="onselectModule($event)">
                                <option selected disabled>-- Select Module
                                    --</option>
                                <option *ngFor="let module of modules"
                                    [value]="module.moD_ID">{{ module.module
                                    }}</option>
                            </select>
                        </div>

                        <!-- Time Mode -->
                        <div class="col-md-4" *ngIf="isProjectSelected">
                            <label class="form-label fw-bold">Time Mode</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio"
                                    name="timeType" value="1"
                                    (change)="onselectTimeType($event)">
                                <label class="form-check-label">Full</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio"
                                    name="timeType" value="2"
                                    (change)="onselectTimeType($event)">
                                <label class="form-check-label">Split</label>
                            </div>
                        </div>

                        <!-- Time -->
                        <div class="col-md-4" *ngIf="isProjectSelected">
                            <label class="form-label fw-bold">Time</label>
                            <select class="form-select"
                                formControlName="minute">
                                <option selected disabled>Select Minute</option>
                                <option *ngFor="let min of minutes"
                                    [value]="min+1">{{ min+1 }} minutes</option>
                            </select>
                        </div>

                        <!-- Description -->
                        <div class="col-md-8" *ngIf="isProjectSelected">
                            <label
                                class="form-label fw-bold">Description</label>
                            <textarea class="form-control" rows="2"
                                formControlName="description"></textarea>
                        </div>
                    </div>

                    <!-- Conditional Time -->
                    <div class="row g-3 mt-3" *ngIf="condition">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Time
                                (Conditional)</label>
                            <select class="form-select"
                                formControlName="minute">
                                <option selected disabled>Select Minute</option>
                                <option *ngFor="let min of minutes"
                                    [value]="min+1">{{ min+1 }} minutes</option>
                            </select>
                        </div>
                    </div>

                    <!-- Submit -->
                    <div class="row mt-4" *ngIf="isProjectSelected">
                        <div class="col text-end">
                            <button class="btn btn-success" type="submit"
                                (click)="onSubmit()"
                                [disabled]="timesheetForm.invalid">
                                Submit Task
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Approved Button -->
    <div class="row justify-content-end mt-3">
        <div class="col-md-3 text-end">
            <button class="btn btn-primary w-100" (click)="onApproveClick()"
                [disabled]="taskApproved">
                Approve Task
            </button>
        </div>
    </div>
</div>
