<app-navbar></app-navbar>
<div class="container border p-3 mt-3" [formGroup]="timesheetForm">
    <div class="row">
        <p>Live Time: {{ currentDateTime | date: 'medium' }}</p>
    </div>
    <div class="row">
        <table>
            <tr>
                <td>
                    <label for="timeslot">Timeslot</label>
                    <select id="timeslot" class="w-100 mh-3" formControlName="timeslot"
                        (change)="onfunctionchage($event)">
                        <option value="{{data.sloT_ID}}" *ngFor="let data of SlotDetails">{{data.sloT_NAME}}</option>
                    </select>
                </td>
                <td>
                    <label for="function">Functions</label>
                    <select formControlName="function" (change)="onselectfunction($event)">
                        <option value="">-- Select Function --</option>
                        <option *ngFor="let func of functions; let i = index" [value]="i">
                            {{ func.fuN_NAME }}
                        </option>
                    </select>
                    <div class="text-danger"
                        *ngIf="timesheetForm.get('function')?.invalid && timesheetForm.get('function')?.touched">
                        Function is required
                    </div>
                </td>
                <td>
                    <label for>ClientCode - ProjectName</label>
                    <select class="w-100" formControlName="projectAndClient" (change)="onprojectselect($event)">
                        <option value>-- Select Project Name --</option>
                        <option *ngFor="let prod of projectClients" [value]="prod.proJ_ID">{{
                            prod.client_code+'-'+prod.proj_name }}</option>
                    </select>
                    <div class="text-danger"
                        *ngIf="timesheetForm.get('projectAndClient')?.invalid && timesheetForm.get('projectAndClient')?.touched">
                        clientCode-productName is required
                    </div>
                </td>

                <td>
                    <label for>Modules</label>
                    <select class="w-100" formControlName="module" (change)="onselectModule($event)">
                        <option value>-- Select Module --</option>
                        <option value="{{module.moD_ID}}" *ngFor="let module of modules">{{module.module}}</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label for>Time Mode</label>
                    <select class="w-100" formControlName="type " (change)="onselectTimeType($event)">

                        <option value [selected]="true">-- Select Module --</option>
                        <option value="1">Full</option>
                        <option value="2">Split</option>
                    </select>
                </td>
                <td *ngIf="condition">
                    <label for>Time</label>
                    <select class="w-100" formControlName="minute">
                        <option value disabled>Select Minute</option>
                        <option *ngFor="let min of minutes" [value]="min+1">{{ min+1
                            }} minutes</option>
                    </select>

                </td>
                <td>
                    <label for>Description</label>
                    <textarea formControlName="description"></textarea>
                </td>
                <td>
                    <button class="btn btn-success" type="submit" (click)="onSubmit()"
                        [disabled]="timesheetForm.invalid">
                        Submit Task
                    </button>
                </td>
            </tr>
        </table>
    </div>

    <div class="row">
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>Timeslot</th>
                    <th>Function</th>
                    <th>Project & Client</th>
                    <th>Module</th>
                    <th>Minute</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let group of groupedTimesheet">
                    <tr *ngFor="let entry of group.entries; let i = index">
                        <td *ngIf="i === 0" [attr.rowspan]="group.entries.length">{{
                            group.timeslot }}</td>
                        <td>{{ entry.function }}</td>
                        <td>{{ entry.projectAndClient }}</td>
                        <td>{{ entry.module }}</td>
                        <td>{{ entry.minute }}</td>
                    </tr>
                    <tr>

                    </tr>
                </ng-container>
            </tbody>
        
        </table>

    </div>
  
    <div class="row justify-content-center">
  <button class="btn btn-success w-25" (click)="onApproveClick()" [disabled]="taskApproved">Approved Task</button>
</div>
</div>